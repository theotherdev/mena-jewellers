{% liquid
  assign selected_collection = section.settings.collection
  assign products_to_show = section.settings.products_count
%}

<section class="trending-grid full-width">
  <div class="trending-grid__header-wrap">
    <h2 class="trending-grid__heading">{{ section.settings.heading }}</h2>
  </div>

  {% if selected_collection != blank and selected_collection.products_count > 0 %}
    <div class="trending-grid__cards" style="--columns-desktop: {{ section.settings.columns_desktop }}; --columns-tablet: {{ section.settings.columns_tablet }}; --columns-mobile: {{ section.settings.columns_mobile }};">
      {% for product in selected_collection.products limit: products_to_show %}
        <article class="trending-card">
          <a href="{{ product.url }}" class="trending-card__media">
            {% if product.featured_image %}
              {% liquid
                if forloop.index <= 2
                  assign image_loading = 'eager'
                  assign image_fetchpriority = 'high'
                else
                  assign image_loading = 'lazy'
                  assign image_fetchpriority = 'auto'
                endif
              %}
              <div class="trending-card__image-primary">
                {% render 'image',
                  image: product.featured_image,
                  width: 960,
                  loading: image_loading,
                  fetchpriority: image_fetchpriority
                %}
              </div>
              {% if product.images[1] %}
                <div class="trending-card__image-secondary">
                  {% render 'image',
                    image: product.images[1],
                    width: 960,
                    loading: 'lazy',
                    fetchpriority: 'auto'
                  %}
                </div>
              {% endif %}
            {% else %}
              {{ 'product-1' | placeholder_svg_tag: 'trending-card__placeholder' }}
            {% endif %}

            <span class="trending-card__add">Add +</span>
          </a>

          <div class="trending-card__meta">
            <a href="{{ product.url }}" class="trending-card__title">{{ product.title }}</a>
            <p class="trending-card__price">{{ product.price | money }}</p>
            {% if product.selected_or_first_available_variant.option1 != blank %}
              <p class="trending-card__variant">{{ product.selected_or_first_available_variant.option1 }}</p>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <div class="trending-grid__empty">
      <p>{{ 'sections.product_grid.no_products' | t }}</p>
    </div>
  {% endif %}
</section>

{% stylesheet %}
  .trending-grid {
    background: #f2f2f2;
    font-family: Inter, 'Helvetica Neue', Helvetica, Arial, sans-serif;
    padding: 56px 0 24px;
  }

  .trending-grid__header-wrap {
    padding: 0 80px 32px;
  }

  .trending-grid__heading {
    font-size: 31.3px;
    font-weight: 500;
    letter-spacing: 1.6px;
    line-height: 32px;
    margin: 0;
    text-transform: uppercase;
  }

  .trending-grid__cards {
    display: grid;
    grid-template-columns: repeat(var(--columns-mobile, 1), minmax(0, 1fr));
  }

  .trending-card {
    background: #fff;
    border-right: 0.667px solid #b2b0a1;
    border-top: 0.667px solid #b2b0a1;
    display: flex;
    flex-direction: column;
    min-height: 100%;
  }

  .trending-card:nth-child(1),
  .trending-card:nth-child(2),
  .trending-card:nth-child(3),
  .trending-card:nth-child(4) {
    border-top: 0.667px solid #b2b0a1;
  }

  .trending-card:first-child {
    border-left: 0.667px solid #b2b0a1;
  }

  .trending-card__media {
    background: #f6f6f6;
    display: block;
    overflow: hidden;
    padding-top: 118.9%;
    position: relative;
  }

  .trending-card__image-primary,
  .trending-card__image-secondary {
    inset: 0;
    position: absolute;
    transition: opacity 0.25s ease;
  }

  .trending-card__image-secondary {
    opacity: 0;
  }

  .trending-card:hover .trending-card__image-secondary {
    opacity: 1;
  }

  .trending-card__media .image,
  .trending-card__media .image img {
    height: 100%;
    object-fit: cover;
    width: 100%;
  }

  .trending-card__add {
    background: #f3f3f3;
    bottom: 12px;
    color: #79786c;
    font-size: 11.8px;
    left: 50%;
    letter-spacing: 0.24px;
    line-height: 15.96px;
    padding: 2px 8px;
    position: absolute;
    text-transform: uppercase;
    transform: translateX(-50%);
  }

  .trending-card__meta {
    background: #f8f8f8;
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-height: 82px;
    padding: 12px 8px 14px;
  }

  .trending-card__title {
    color: #68675e;
    font-size: 11.4px;
    letter-spacing: 0.24px;
    line-height: 15.96px;
    text-decoration: none;
    text-transform: uppercase;
  }

  .trending-card__price {
    color: #000;
    font-size: 12px;
    letter-spacing: 0.24px;
    line-height: 18px;
    margin: 0;
    text-transform: uppercase;
  }

  .trending-card__variant {
    color: #68675e;
    font-size: 12px;
    letter-spacing: -0.12px;
    line-height: 18.62px;
    margin: 0;
  }

  .trending-grid__empty {
    padding: 48px;
    text-align: center;
  }

  @media (min-width: 768px) {
    .trending-grid__cards {
      grid-template-columns: repeat(var(--columns-tablet, 2), minmax(0, 1fr));
    }
  }

  @media (min-width: 1200px) {
    .trending-grid__cards {
      grid-template-columns: repeat(var(--columns-desktop, 4), minmax(0, 1fr));
    }
  }

  @media (max-width: 989px) {
    .trending-grid {
      padding-top: 32px;
    }

    .trending-grid__header-wrap {
      padding: 0 20px 20px;
    }

    .trending-grid__heading {
      font-size: 24px;
      line-height: 26px;
    }

    .trending-card {
      border-left: 0.667px solid #b2b0a1;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:general.product_grid",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "TOP 15 TRENDING PRODUCTS"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "t:labels.collection"
    },
    {
      "type": "range",
      "id": "products_count",
      "min": 4,
      "max": 24,
      "step": 1,
      "label": "t:labels.products_to_show",
      "default": 15
    },
    {
      "type": "header",
      "content": "t:general.layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 5,
      "step": 1,
      "label": "t:labels.columns_desktop",
      "default": 4
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "min": 1,
      "max": 3,
      "step": 1,
      "label": "t:labels.columns_tablet",
      "default": 2
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "t:labels.columns_mobile",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ],
      "default": "1"
    }
  ],
  "presets": [
    {
      "name": "t:general.product_grid"
    }
  ]
}
{% endschema %}