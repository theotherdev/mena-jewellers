class ProductPage{constructor(){this.gallery=document.getElementById("product-gallery"),this.gallery&&(this.imagesContainer=this.gallery.querySelector(".product__images"),this.images=this.gallery.querySelectorAll(".product__image-wrapper"),this.prevBtn=this.gallery.querySelector(".product__nav--prev"),this.nextBtn=this.gallery.querySelector(".product__nav--next"),this.prevBtnDesktop=document.querySelector(".product__nav-desktop--prev"),this.nextBtnDesktop=document.querySelector(".product__nav-desktop--next"),this.variantButtons=document.querySelectorAll(".product__variant-btn"),this.variantSelect=document.getElementById("product-select"),this.productForm=document.querySelector(".product__form"),this.currentIndex=0,this.init())}init(){this.setupImageNavigation(),this.setupVariantSelection(),this.setupAjaxCart(),this.checkCartDrawerFlag()}setupImageNavigation(){this.prevBtn&&this.nextBtn&&(this.prevBtn.addEventListener("click",()=>{this.currentIndex>0&&(this.currentIndex--,this.scrollToImage(this.currentIndex))}),this.nextBtn.addEventListener("click",()=>{this.currentIndex<this.images.length-1&&(this.currentIndex++,this.scrollToImage(this.currentIndex))})),this.prevBtnDesktop&&this.nextBtnDesktop&&(this.prevBtnDesktop.addEventListener("click",()=>{this.currentIndex>0&&(this.currentIndex--,this.scrollToImage(this.currentIndex))}),this.nextBtnDesktop.addEventListener("click",()=>{this.currentIndex<this.images.length-1&&(this.currentIndex++,this.scrollToImage(this.currentIndex))}))}scrollToImage(t){const e=this.images[t];e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}setupVariantSelection(){if(0===this.variantButtons.length||!this.variantSelect)return;const t={},e=window.productVariants||[],r=this.variantSelect.options[this.variantSelect.selectedIndex];if(r){const e=r.text.split(" - ")[0].split(" / ");this.variantButtons.forEach(r=>{const n=r.dataset.optionPosition,s=r.dataset.optionValue;e.includes(s)&&(t[n]=s,r.classList.add("selected"))})}this.variantButtons.forEach(r=>{r.addEventListener("click",()=>{if(r.disabled)return;const n=r.dataset.optionPosition,s=r.dataset.optionValue;t[n]=s,document.querySelectorAll(`[data-option-position="${n}"]`).forEach(t=>{t.classList.remove("selected")}),r.classList.add("selected");const o=Array.from(this.variantSelect.options).find(e=>{const r=e.text.split(" - ")[0].split(" / ");return Object.values(t).every(t=>r.includes(t))});if(o){this.variantSelect.value=o.value;const t=document.querySelector(".product__add-to-cart"),r=e.find(t=>t.id==o.value);r&&(t.disabled=!r.available,t.textContent=r.available?"Add to Cart":"Sold Out")}})})}setupAjaxCart(){this.productForm&&this.productForm.addEventListener("submit",t=>{t.preventDefault();const e=new FormData(this.productForm),r=this.productForm.querySelector(".product__add-to-cart"),n=r.textContent;r.disabled=!0,r.textContent="Adding...",fetch("/cart/add.js",{method:"POST",body:e}).then(t=>{if(!t.ok)throw new Error("Failed to add to cart");return t.json()}).then(t=>{sessionStorage.setItem("openCartDrawer","true"),window.location.reload()}).catch(t=>{console.error("Error adding to cart:",t),r.disabled=!1,r.textContent=n,alert("Error adding item to cart. Please try again.")})})}checkCartDrawerFlag(){if("true"===sessionStorage.getItem("openCartDrawer")){sessionStorage.removeItem("openCartDrawer");const t=document.querySelector("[data-cart-trigger]");t&&t.click()}}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>new ProductPage):new ProductPage;